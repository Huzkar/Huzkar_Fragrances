<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order Form</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <form id="custom-form" action="https://docs.google.com/forms/u/0/d/e/1FAIpQLSevCjhUIoCYPG8CG873sHqhQOYT4OwZSg8ge9RnzxfwyTCHjQ/formResponse" method="POST"></form>
        <label for="productName">Product Name:</label>
        <input type="text" id="productName" name="productName" readonly><br>

        <label for="price">Price (per unit):</label>
        <input type="text" id="price" name="price" readonly><br>

        <label for="quantity">Quantity:</label>
        <input type="number" id="quantity" name="quantity" value="1" min="1"><br>

        <label for="bottleOffer">Stylish Bottle:</label>
        <select id="bottleOffer" name="bottleOffer">
            <option value="No">No</option>
            <option value="Yes">Yes</option>
        </select><br>

        <!-- Stylish Bottle Price (Initially Hidden) -->
        <div id="bottlePriceContainer">
            <label for="bottlePrice">Stylish Bottle Price:</label>
            <select id="bottlePrice" name="bottlePrice">
                <option value="3ml">3ml (130 Rs)</option>
                <option value="6ml">6ml (180 Rs)</option>
                <option value="12ml">12ml (230 Rs)</option>
            </select><br>
        </div>

        <label for="paymentMethod">Payment Method:</label>
        <select id="paymentMethod" name="paymentMethod">
            <option value="Online Payment">Online Payment</option>
            <option value="Cash on Delivery">Cash on Delivery</option>
        </select><br>

        <label for="totalPrice">Total Price:</label>
        <input type="text" id="totalPrice" name="totalPrice" readonly><br>

        <button type="submit">Submit</button>
    </form>

    <!-- Confirmation Message (Hidden Initially) -->
    <div id="confirmation-message" style="display: none;">
        <h3>Thank you! Your order has been submitted.</h3>
    </div>

    <iframe name="hidden_iframe" style="display: none;"></iframe>

    <script>
        let submitted = false;

        // Extract URL parameters and prefill the form
        const params = new URLSearchParams(window.location.search);
        const productName = params.get('product');
        const price = parseFloat(params.get('price')) || 0;

        document.getElementById('productName').value = productName || "N/A";
        document.getElementById('price').value = price;

        const quantityInput = document.getElementById('quantity');
        const totalPriceInput = document.getElementById('totalPrice');
        const bottleOffer = document.getElementById('bottleOffer');
        const bottlePrice = document.getElementById('bottlePrice');
        const bottlePriceContainer = document.getElementById('bottlePriceContainer');
        const paymentMethod = document.getElementById('paymentMethod');
        const form = document.getElementById("custom-form");
        const confirmationMessage = document.getElementById("confirmation-message");

        // Hide Stylish Bottle Price dropdown initially if "No" is selected
        function updateBottleVisibility() {
            if (bottleOffer.value === "Yes") {
                bottlePriceContainer.style.display = "block"; // Show dropdown
            } else {
                bottlePriceContainer.style.display = "none"; // Hide dropdown
            }
            updateTotalPrice();
        }

        // Function to calculate total price
        function updateTotalPrice() {
            const quantity = parseInt(quantityInput.value, 10) || 1;
            let bottlePriceValue = 0;

            // Check if Stylish Bottle is selected
            if (bottleOffer.value === "Yes") {
                if (bottlePrice.value === "3ml") bottlePriceValue = 130;
                else if (bottlePrice.value === "6ml") bottlePriceValue = 180;
                else if (bottlePrice.value === "12ml") bottlePriceValue = 230;
            }

            // Calculate final total price
            totalPriceInput.value = (price * quantity) + bottlePriceValue;
        }

        // Ensure form does NOT hide when "No" is selected
        bottleOffer.addEventListener("change", updateBottleVisibility);

        // Ensure total price updates correctly
        quantityInput.addEventListener("input", updateTotalPrice);
        bottlePrice.addEventListener("change", updateTotalPrice);

        // Initial setup
        updateBottleVisibility();
        updateTotalPrice();

        // Handle form submission properly
        form.onsubmit = function(event) {
            event.preventDefault(); // Prevent default form submission

            // Ensure all required dropdowns are selected
            if (!bottleOffer.value || (bottleOffer.value === "Yes" && !bottlePrice.value) || !paymentMethod.value) {
                alert("Please select all required fields before submitting.");
                return false;
            }

            submitted = true;

            // Submit the form programmatically using an iframe
            this.target = "hidden_iframe"; // Submits the form in the hidden iframe
            this.submit();

            // **Show Confirmation Message ONLY After Submission**
            setTimeout(() => {
                form.style.display = "none"; // Hide the form
                confirmationMessage.style.display = "block"; // Show confirmation message
            }, 500); // Wait 0.5s for submission to complete
        };
    </script>
</body>
</html>
